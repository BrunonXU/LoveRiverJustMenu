# 遇到的问题与解决办法

## 问题一：Flutter Web 资源 404

- **现象**  
  - 浏览器 Console 报错：  
    ```
    GET https://xuziang.xyz/LoveRiverJustMenu/main.dart.js → ERR_ABORTED 404 (Not Found)
    GET https://xuziang.xyz/LoveRiverJustMenu/manifest.json → 404 (Not Found)
    ```
  - 页面卡在开头，一直加载不到 `main.dart.js`、`manifest.json` 等静态文件。

- **原因**  
  - 原本项目编译输出在 `LoveRiverJustMenu/` 子目录，`index.html` 的 `<base href="/LoveRiverJustMenu/">` 指向子路径。  
  - 自定义域绑定后，访问根域(`https://xuziang.xyz/`)时，根目录下并不存在 `LoveRiverJustMenu/` 子文件夹，导致所有资源请求都 404。

- **解决办法**  
  1. **重新编译**  
     ```bash
     flutter build web --base-href /
     ```
     - 将 `<base href="/">` 固定为根目录。  
  2. **部署到根目录**  
     - 把 `build/web/` 下的所有文件（`index.html`、`main.dart.js`、`manifest.json`、`assets/` 等）  
       直接推到 GitHub Pages 分支（或 `docs/`）的 根 目录，**不要**放在子文件夹。  
  3. **验证**  
     - 清空浏览器缓存后访问 `https://xuziang.xyz/`，Console 不再报 404，页面能正常加载。

---

## 问题二：GitHub Pages 自定义域 HTTPS 和 Cloudflare 冲突

- **现象**  
  - GitHub Pages Settings → Pages 中，自定义域显示 “DNS 检查成功”，但 Enforce HTTPS 灰掉，且提示：  
    > `www.xuziang.xyz 配置不正确（NotServedByPagesError）`  
  - 页面上显示“不安全”，无法开启 HTTPS 强制。

- **原因**  
  - 为了国内加速，DNS 记录在 Cloudflare 上开启了 **橙色云朵（Proxied）**，导致域名解析到 Cloudflare Anycast IP。  
  - GitHub Pages 验证自定义域时，只能识别 **直连** 到它的 A/CNAME 记录，一旦看到 Cloudflare IP，就认为 “Not Served By Pages”。

- **解决办法**  
  1. **临时切换为 DNS-only**  
     - 在 Cloudflare → DNS 面板，将以下记录的代理状态改为 **灰色云朵（DNS only）**：  
       ```
       A    @   185.199.108.153  
       A    @   185.199.109.153  
       A    @   185.199.110.153  
       A    @   185.199.111.153  
       CNAME www brunonxu.github.io
       ```
  2. **GitHub Pages 再次检查**  
     - 回 GitHub 仓库 Settings → Pages → 点击 “再次检查”，等待几分钟，看到：  
       - 自定义域校验通过  
       - Enforce HTTPS 可勾选  
  3. **恢复 Cloudflare 代理**  
     - 再次在 Cloudflare → DNS，将上述记录切回 **橙色云朵（Proxied）**，启用加速、免费 SSL、WAF 等功能。  
  4. **Cloudflare SSL/TLS & 性能配置**  
     - **SSL/TLS** → Edge Certificates  
       - 模式：`Full`  
       - 开启：`Always Use HTTPS`、`Automatic HTTPS Rewrites`  
     - **Speed → Optimization**  
       - 开启 `Auto Minify`（JS/CSS/HTML）、`Brotli`  
     - **Caching → Configuration**  
       - `Browser Cache TTL`：`1 day`  
       - 开启 `Always Online`  
     - （可选）**Page Rules**：  
       ```text
       URL: https://xuziang.xyz/*
       Cache Level: Cache Everything
       Edge Cache TTL: 4 hours
       ```
  5. **效果验证**  
     - `dig +short xuziang.xyz` → 返回 GitHub Pages IP  
     - 浏览器访问 `https://xuziang.xyz/` → 显示绿锁，页面正常加载  
     - 国内访问不再挂 VPN，速度稳定

---

> ⚠️ **注意**：  
> - 在任何修改 DNS 代理状态后，建议等待 TTL 生效（通常几分钟）再测试。  
> - 如果还使用子域 `www`，也需同样操作：先 DNS-only，再验证，通过后再切回 Proxied。

